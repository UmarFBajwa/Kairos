(function(window,document){(function(root){var setTimeoutFunc=setTimeout;function noop(){}var asap=typeof setImmediate==="function"&&setImmediate||function(fn){setTimeoutFunc(fn,0)};var onUnhandledRejection=function onUnhandledRejection(err){if(typeof console!=="undefined"&&console){console.warn("Possible Unhandled Promise Rejection:",err)}};function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof fn!=="function")throw new TypeError("not a function");this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];doResolve(fn,this)}function handle(self,deferred){while(self._state===3){self=self._value}if(self._state===0){self._deferreds.push(deferred);return}self._handled=true;asap(function(){var cb=self._state===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){(self._state===1?resolve:reject)(deferred.promise,self._value);return}var ret;try{ret=cb(self._value)}catch(e){reject(deferred.promise,e);return}resolve(deferred.promise,ret)})}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(newValue instanceof Promise){self._state=3;self._value=newValue;finale(self);return}else if(typeof then==="function"){doResolve(bind(then,newValue),self);return}}self._state=1;self._value=newValue;finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2;self._value=newValue;finale(self)}function finale(self){if(self._state===2&&self._deferreds.length===0){asap(function(){if(!self._handled){onUnhandledRejection(self._value)}})}for(var i=0,len=self._deferreds.length;i<len;i++){handle(self,self._deferreds[i])}self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,self){var done=false;try{fn(function(value){if(done)return;done=true;resolve(self,value)},function(reason){if(done)return;done=true;reject(self,reason)})}catch(ex){if(done)return;done=true;reject(self,ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);handle(this,new Handler(onFulfilled,onRejected,prom));return prom};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==="object"||typeof val==="function")){var then=val.then;if(typeof then==="function"){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(--remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject)}})};Promise._setImmediateFn=function _setImmediateFn(fn){asap=fn};Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){onUnhandledRejection=fn};root.Promise=Promise})(this);"use strict";var tetra,services,events,http,CONFIG,promise;CONFIG={};CONFIG.URL="http://terminal.ingenico.com";CONFIG.SERVICE_URL=CONFIG.URL+"/service";CONFIG.WAAS_URL=CONFIG.URL+"/waas";CONFIG.DESKTOP_WAID="00000000";CONFIG.WP_VERSION=null;CONFIG.START_END={SE_START:{id:1},SE_CHECK_PREPARE:{id:2},SE_END:{id:3}};http={parse:function(data){var d,buffer=[];for(d in data){if(data.hasOwnProperty(d)){buffer.push(d+"="+data[d])}}return encodeURI(buffer.join("&"))},ajax:function(method,url,data,callback,error,timeout,async,expect){var xmlreq=new XMLHttpRequest;xmlreq.open(method,url,async);if(method==="POST"||method==="PUT"){data=data&&(typeof data==="string"?data:JSON.stringify(data))}xmlreq.onreadystatechange=function(){var response;function onError(){error&&error({msg:xmlreq.statusText||"XMLHttpRequest error status "+xmlreq.status,status:xmlreq.status,response:response})}function onSuccess(){callback&&callback(response)}if(xmlreq.readyState===4){xmlreq.onreadystatechange=null;if(xmlreq.status===200||xmlreq.status===204){response=xmlreq&&xmlreq.responseText?JSON.parse(xmlreq.responseText):null;if(expect&&typeof expect==="function"){if(expect(response)){onSuccess()}else{onError()}return}if(response&&response.return){onError()}else{onSuccess()}}else{response=xmlreq&&xmlreq.responseText?JSON.parse(xmlreq.responseText):null;onError()}}};if(timeout){xmlreq.timeout=timeout}xmlreq.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlreq.send(data)},post:function(url,data,callback,error,timeout,expect){this.ajax("POST",url,data,callback,error,timeout,true,expect)},get:function(url,callback,error,timeout){this.ajax("GET",url,null,callback,error,timeout,true)},del:function(url,data,callback,error,timeout,async){this.ajax("DELETE",url,data,callback,error,timeout,async)},put:function(url,data,callback,error,timeout){this.ajax("PUT",url,data,callback,error,timeout,true)}},services=[],events={},promise=null;function getTimeout(timeout){return timeout||this.timeout||this.requestTimeout}function getDelay(delay){return delay||this.delay||this.requestDelay}function getThen(then){return then||this.then}var Service=function(options){var me,sse,serviceName,namespace,formats,hidden;options=options||{},sse={},hidden=false,serviceName=options.service,namespace=options.namespace,formats=options.formats;return me={serviceName:serviceName,connected:false,promise:null,evtSource:null,handler:{resolve:null,reject:null,promise:null},requestDelay:options.requestDelay||tetra.requestDelay,requestTimeout:options.requestTimeout||tetra.requestTimeout,connect:function(options){options=options||{};options.then=options.then||"both";this.doPromise(options,function(onSuccess,onError,timeout){if(!me.connected){var onSuccessWrapper=function(response){me.connected=true;return onSuccess(response)};var formatsParameters="";for(var format in formats){formatsParameters+="format_"+(namespace||"")+"."+format+"="+formats[format]+"&"}return http.get(CONFIG.SERVICE_URL+"/"+serviceName+"?"+formatsParameters,onSuccessWrapper,onError,timeout)}else{console.info("Already connected");return onSuccess()}});return this},disconnect:function(options){options=options||{};options.then=options.then||"both";this.doPromise(options,function(onSuccess,onError,timeout){if(me.connected){var onSuccessWrapper=function(response){me.connected=false;return onSuccess(response)};return http.del(CONFIG.SERVICE_URL+"/"+serviceName,{},onSuccessWrapper,onError,timeout,options.async===false?false:true)}else{console.info("Not connected");return onSuccess()}});return this},call:function(methodName,options){options=options||{};options.then=options.then||"resolved";this.doPromise(options,function(onSuccess,onError,timeout){if(me.connected){var req=(namespace?namespace+".":"")+methodName+"Request",res=(namespace?namespace+".":"")+methodName+"Response",data=options.data||{};if(options.hide){hidden=true}var onSuccessWrapper=function(response){if(hidden){hidden=false;tetra.show()}return onSuccess(response)};var onErrorWrapper=function(response){if(hidden){hidden=false;tetra.show()}return onError(response)};return http.post(CONFIG.SERVICE_URL+"/"+serviceName+"?request="+req+"&response="+res,data,onSuccessWrapper,onErrorWrapper,timeout,options.expect)}else{return onError({msg:"Not connected call"})}});return this},doPromise:function(options,fn){return tetra.doPromise.apply(this,[options,fn])},reset:function(){return tetra.reset.call(this)},then:function(onSuccess,onError){return tetra.then.call(this,onSuccess,onError)},catch:function(error){return tetra.then.call(this,null,error)},success:function(success){return tetra.then.call(this,success,null)},error:function(error){return tetra.then.call(this,null,error)},resolve:function(response){return tetra.resolve.call(this,response,me.handler)},reject:function(reason){return tetra.reject.call(this,reason,me.handler)},on:function(eventName,callback,context){if(eventName&&!eventName.match(/\./)&&eventName!=="message"){eventName=(namespace?namespace+".":"")+eventName}options=options||{};options.then=options.then||"resolved";this.doPromise(options,function(onSuccess,onError,timeout){if(!me.evtSource){return onError()}context=context||me;sse[eventName]={eventName:eventName,callback:callback,context:context};me.evtSource.addEventListener(eventName,function(response){var data=JSON.parse(response.data);sse[eventName].callback.call(context,data)},false);return onSuccess()});return this},open:function(options){options=options||{};options.then=options.then||"resolved";this.doPromise(options,function(onSuccess,onError,timeout){if(me.connected&&!me.evtSource){me.evtSource=new window.EventSource(CONFIG.SERVICE_URL+"/"+serviceName+"/sse");me.evtSource.onerror=function(e){return onError(e)};me.evtSource.onopen=function(e){return onSuccess(e)};return onSuccess()}else{return onError({msg:"Not connected or event already opened"})}});return this},close:function(options){options=options||{};options.then=options.then||"resolved";if(!me.evtSource){return this}this.doPromise(options,function(onSuccess,onError,timeout){if(me.evtSource){me.off();me.evtSource.close();me.evtSource=null;return onSuccess()}else{return onError({msg:"Event source not exist"})}});return this},off:function(eventName,handler,context){if(eventName&&!eventName.match(/\./)&&eventName!=="message"){eventName=(namespace?namespace+".":"")+eventName}if(!me.evtSource){return this}function remove(eventName){me.evtSource.removeEventListener(eventName,handler||sse[eventName].callback,false);delete sse[eventName]}if(!eventName){for(var evt in sse){var evtName;evtName=sse[evt].eventName;remove(evtName)}}else if(typeof eventName==="string"){remove(eventName)}else if(typeof eventName==="object"&&eventName instanceof Array){for(var i=0,len=eventName.length;i<len;i++){var evtName;evtName=eventName[i];remove(evtName)}}else{for(var evt in sse){var evtName;evtName=sse[evt].eventName;if(evtName.match(eventName)){remove(evtName)}}}return this},destroy:function(){var service;this.disconnect().close({success:this.reset});service=services.indexOf(this);services.splice(service,1)}}};tetra={version:"1.5.0",requestDelay:0,requestTimeout:0,handler:{resolve:null,reject:null,promise:null},setup:function(properties,callback){var serviceUrl="http://terminal.ingenico.com/setup";function agregate(response){response.requestDelay=tetra.requestDelay;response.requestTimeout=tetra.requestTimeout}if(callback&&typeof callback==="function"){console.warn("Deprecated since 1.1.0");var options;if(typeof properties==="function"){http.get(serviceUrl,function(response){agregate(response);return properties(response)})}else if(typeof properties==="object"){options=JSON.parse(JSON.stringify(properties));tetra.requestDelay=options.requestDelay||tetra.requestDelay;tetra.requestTimeout=options.requestTimeout||tetra.requestTimeout;delete options.requestDelay;delete options.requestTimeout;http.post(serviceUrl,options,callback)}}else{properties=properties||{};properties.then=properties.then||"both";if(properties&&properties.data){var data=JSON.parse(JSON.stringify(properties.data));tetra.requestDelay=properties.data.requestDelay||tetra.requestDelay;tetra.requestTimeout=properties.data.requestTimeout||tetra.requestTimeout;delete data.requestDelay;delete data.requestTimeout;this.doPromise(properties,function(onSuccess,onError,timeout){return http.post(serviceUrl,data,onSuccess,onError,timeout)})}else{this.doPromise(properties,function(onSuccess,onError,timeout){return http.get(serviceUrl,onSuccess,onError,timeout)})}}return this},service:function(options){var service;for(var i=0,len=services.length;i<len;i++){var serviceInstance;serviceInstance=services[i];if(serviceInstance.serviceName===options.service){return serviceInstance}}if(!options.service){return new Error(".service property is missing")}service=new Service(options);services.push(service);return service},disconnect:function(){for(var i=0,len=services.length;i<len;i++){var service;service=services[i];if(service.connected){http.del(CONFIG.SERVICE_URL+"/"+service.serviceName,{},function(){},function(){},service.requestTimeout,false)}}return this},destroy:function(){for(var i=0,len=services.length;i<len;i++){var service;service=services[i];service.destroy()}return this},lookup:function(interfaceName,callback){if(callback&&typeof callback==="function"){console.warn("Deprecated since 1.1.0");interfaceName&&http.get(CONFIG.SERVICE_URL+"?interface="+interfaceName,callback)}else{var options=callback||{};options.then=options.then||"both";this.doPromise(options,function(onSuccess,onError,timeout){return http.get(CONFIG.SERVICE_URL+"?interface="+interfaceName,onSuccess,onError,timeout)})}return this},hide:function(){console.log("INGENICO:WCE:hide")},show:function(){console.log("INGENICO:WCE:show")},hideWP:function(){console.log("INGENICO:WCE:hideWP")},showWP:function(){console.log("INGENICO:WCE:showWP")},weblet:{hide:function(){console.log("INGENICO:WEBLET:hide");return this},show:function(){console.log("INGENICO:WEBLET:show");return this},notify:function(data){data=data||{};var badge=data.badge||"default";var count=data.count||0;var save=data.save||false;var id=data.id?":"+data.id:"";console.log("INGENICO:NOTIFY:"+badge+":"+count+":"+save+id);return this},on:function(eventName,callback,context){if(eventName==="wakeup"){tetra.createWakeupEvent()}context=context||this;events[eventName]={eventName:eventName,callback:callback.bind(context),context:context};window.addEventListener(eventName,events[eventName].callback,false);return this},trigger:function(eventName,data){data=data||{};function dispatch(eventName){var event;event=new CustomEvent(eventName,data);window.dispatchEvent(event)}if(!eventName){for(var evt in events){var evtName;evtName=events[evt].eventName;dispatch(evtName)}}else if(typeof eventName==="string"){dispatch(eventName)}else if(typeof eventName==="object"&&eventName instanceof Array){for(var i=0,len=eventName.length;i<len;i++){dispatch(eventName[i])}}else{for(var evt in events){var evtName;evtName=events[evt].eventName;if(evtName.match(eventName)){dispatch(evtName)}}}return this},off:function(eventName,handler,context){function remove(eventName){window.removeEventListener(eventName,handler||events[eventName].callback,false);delete events[eventName]}if(!eventName){for(var evt in events){var evtName;evtName=events[evt].eventName;remove(evtName)}}else if(typeof eventName==="string"){remove(eventName)}else if(typeof eventName==="object"&&eventName instanceof Array){for(var i=0,len=eventName.length;i<len;i++){remove(eventName[i])}}else{for(var evt in events){var evtName;evtName=events[evt].eventName;if(evtName.match(eventName)){remove(evtName)}}}return this}},waas:function(interfaceName,options){var service,evtSource,evtSourceWaas,events,namespace;namespace=interfaceName.replace(/\.\w+$/,"");options=options||{},events=[];function Waas(){var Send=function(method){this.connectionId=null;this.sendResponse=function(data,opts,callback,error,timeout,expect){var connectionId="";if(typeof opts==="function"){callback=arguments[2];error=arguments[3];timeout=arguments[4];expect=arguments[5]}if(typeof opts==="object"&&opts.connectionId&&CONFIG.WP_VERSION>=2.06){connectionId="conn_id="+opts.connectionId}if(this.connectionId&&CONFIG.WP_VERSION>=2.06){connectionId="conn_id="+this.connectionId}http.post(CONFIG.WAAS_URL+"/"+interfaceName+"/"+method+"?"+connectionId,data||{},callback,error,timeout,expect);return this}};return{clients:[],sendEvent:function(eventName,data,opts,callback,error,timeout,expect){var connectionId="";if(typeof opts==="function"){callback=arguments[2];error=arguments[3];timeout=arguments[4];expect=arguments[5]}if(typeof opts==="object"&&opts.connectionId&&CONFIG.WP_VERSION>=2.06){connectionId="conn_id="+opts.connectionId}http.post(CONFIG.WAAS_URL+"/"+namespace+"."+eventName+"?"+connectionId,data||{},callback,error,timeout,expect);return this},on:function(eventName,properties,callBack){if(properties&&typeof properties==="function"){callBack=properties;properties={}}events.push({eventName:eventName,properties:properties,callBack:callBack});return this},start:function(){if(!CONFIG.WP_VERSION){setTimeout(function(){service.start()},250);return this}var params,multi;params="?";for(var i=0,len=events.length;i<len;i++){var event=events[i];var properties=event.properties;var eventName=event.eventName;if(properties.perms&&typeof properties.perms==="object"&&properties.perms instanceof Array){params+="perms_"+eventName+"="+properties.perms.toString()+"&"}if(properties.formats){var UpperEventName=eventName[0].toUpperCase()+eventName.slice(1);for(var format in properties.formats){params+="format_"+namespace+"."+UpperEventName+format+"="+properties.formats[format]+"&"}}}if(CONFIG.WP_VERSION>=2.06){multi="multi";params+=multi}evtSource=new window.EventSource(CONFIG.WAAS_URL+"/"+interfaceName+params);evtSourceWaas=new window.EventSource(CONFIG.WAAS_URL+"?"+multi);evtSourceWaas.addEventListener("ingenico.webos.ServiceConnect",function(data){service.clients.push(data.id)});evtSourceWaas.addEventListener("ingenico.webos.ServiceDisconnect",function(data){service.clients.splice(service.clients.indexOf(data.id),1)});for(var i=0,len=events.length;i<len;i++){var event=events[i];var send=new Send(event.eventName);(function(send,event){var attachedEventSource;if(event.eventName==="ingenico.webos.ServiceConnect"||event.eventName==="ingenico.webos.ServiceDisconnect"){evtSource.addEventListener(event.eventName,function(response){event.callBack.call(this,response)},false)}else{evtSource.addEventListener(event.eventName,function(response){var data=JSON.parse(response.data);send.connectionId=data.$wp_connId||data.id;event.callBack.call(send,response);send.connectionId=null},false)}})(send,event)}return this}}}service=new Waas(interfaceName);return service},doPromise:function(options,fn){var me=this;function doPromise(){var promise;promise=new window.Promise(function(resolve,reject){window.setTimeout(function(){return fn(function(response){me.handler.resolve=resolve;me.handler.reject=reject;me.handler.promise=promise;me.resolve(response,me.handler)},function(reason){me.handler.resolve=resolve;me.handler.reject=reject;me.handler.promise=promise;me.reject(reason,me.handler)},getTimeout.call(me,options.requestTimeout))},getDelay.call(me,options.requestDelay))});return promise}if(!this.promise||options.promise){this.promise=doPromise()}else{var then=getThen.call(me,options.then);if(then==="resolved"){me.success(doPromise)}else if(then==="rejected"){me.error(doPromise)}else{me.then(doPromise,doPromise)}}if(options.error||options.success){me.then(options.success,options.error)}return this},then:function(onSuccess,onError){var me=this;if(onSuccess&&!onError){me.promise=me.promise.then(function(response){return onSuccess.call(me,response,me.handler)})}else if(onSuccess&&onError){me.promise=me.promise.then(function(response){return onSuccess.call(me,response,me.handler)},function(reason){return onError.call(me,reason,me.handler)})}else{me.promise=me.promise.catch(function(reason){return onError.call(me,reason,me.handler)})}return this},catch:function(error){this.then(null,error);return this},success:function(success){this.then(success,null);return this},error:function(error){this.then(null,error);return this},resolve:function(response){this.handler.resolve.call(this,response,this.handler);return this},reject:function(reason){this.handler.reject.call(this,reason,this.handler);return this},reset:function(){this.promise=null;return this},checkServices:function(services,options){var _services,me,tried,resolvePromise,rejectPromise;options=options||{};options.delay=options.delay||1e3;options.try=options.try||20;options.then=options.then||"both";me=this,tried=0,_services=services.slice(0);function onSuccessWrapper(){_services.shift();tried=0;check()}function onErrorWrapper(){tried++;setTimeout(check,options.delay)}function check(){if(_services.length&&tried<options.try){tetra.reset().lookup(_services[0],{expect:function(r){return r&&r.length}}).then(onSuccessWrapper,onErrorWrapper)}else{if(tried===options.try){rejectPromise(_services[0])}else{resolvePromise()}}}return me.doPromise({},function(resolve,reject){resolvePromise=resolve;rejectPromise=reject;check()})}};document.addEventListener("visibilitychange",function(){if(document.hidden){tetra.weblet.trigger("hide")}else{tetra.weblet.trigger("show")}});window.addEventListener("beforeunload",function(e){e.preventDefault();tetra.weblet.trigger("close");tetra.disconnect()});tetra.createWakeupEvent=function(){return tetra.service({service:"local.desktopenv.inactivityHandler",namespace:"ingenico.desktopenv"}).reset().disconnect().close().connect().open().on("WakeupEvent",function(r){tetra.weblet.trigger("wakeup",r.cause)})};tetra.service({service:"local.WebOs.Service",namespace:"ingenico.webos"}).connect().call("GetWPVersion").success(function(r){CONFIG.WP_VERSION=parseFloat(r.version,10)}).disconnect();tetra.header={showAll:function(){console.log("INGENICO:HEADER-LEDS:show:show")},hideAll:function(){console.log("INGENICO:HEADER-LEDS:hide:hide")},showLeds:function(){console.log("INGENICO:HEADER-LEDS::show")},hideLeds:function(){console.log("INGENICO:HEADER-LEDS::hide")},showBanner:function(){console.log("INGENICO:HEADER-LEDS:show:")},hideBanner:function(){console.log("INGENICO:HEADER-LEDS:hide:")}};var _notifications={};var notificationService=null;var Notification=function(title,options){var me=this;function processEvent(evtName,data,remove){if(data.tag&&data.tag!==""){_notifications[data.tag]&&_notifications[data.tag][evtName]&&_notifications[data.tag][evtName](_notifications[data.tag]);remove&&delete _notifications[data.tag]}else{for(var tag in _notifications){_notifications[tag][evtName]&&_notifications[tag][evtName](_notifications[tag]);remove&&delete _notifications[tag]}}}if(typeof title!=="string"){return new Error("Title is required")}options=options||{};var data={};this.title=data.title=title;this.tag=data.tag=(options.tag||Math.random())+"";this.ing_buttons=data.ing_buttons=options.ing_buttons||false;if(options.body){data.body=options.body}if(options.onshow){this.onshow=options.onshow}if(options.onclose){this.onclose=options.onclose}if(options.onshow){this.onclick=options.onclick}if(!notificationService){notificationService=tetra.service({service:"local.webapp."+CONFIG.DESKTOP_WAID,namespace:"ingenico.webos"}).reset().connect().open().on("ShowNotificationEvent",function(data){processEvent("onshow",data)}).on("ClickNotificationEvent",function(data){processEvent("onclick",data,true)}).on("CloseNotificationEvent",function(data){processEvent("onclose",data,true)}).call("Notification",{data:data})}else{notificationService.reset().call("Notification",{data:data})}this.close=function(){notificationService.reset().call("CloseNotification",{data:{tag:data.tag}}).then(function(){processEvent("onclose",data,true)})};_notifications[data.tag]=this;return this};window.Notification=Notification;tetra.printer={setDiffuseMode:function(){console.log("INGENICO:WCE:printerDithering:diffuse")},setOrderedMode:function(){console.log("INGENICO:WCE:printerDithering:ordered")},setThreshold:function(value){value=value||"";console.log("INGENICO:WCE:printerDithering:threshold:"+value)}};tetra.startEnd=function(properties){var events,waas,supportedMethods,startEnd;function StartEnd(){var that;that=this;waas=tetra.waas("ingenico.transaction.StartEnd").on("stateSE",function(response){var state=JSON.parse(response.data).state;if(typeof state!=="undefined"){if(state===1){that.enable()}else{that.disable()}return this.sendResponse({state:that.enabled})}else{return this.sendResponse({state:that.enabled})}}).on("getSEImplementedMethods",function(){var result;result={return:1,supportedMethods:supportedMethods};this.sendResponse(result)}).on("executeSE",{formats:{"Request.input":"tlv"}},function(e){var data,handler,me;me=this;data=JSON.parse(e.data);handler=events[data.serviceId];that.sendResponse=function(tlv,callBack){me.sendResponse.call(me,{return:1,output:tlv},{connectionId:data.$wp_connId},callBack)};handler?handler.call(this,data.input,that.enabled):this.sendResponse({},{connectionId:data.$wp_connId})}).start();return this}StartEnd.prototype.enabled=1;StartEnd.prototype.changeState=function(state){return true};StartEnd.prototype.disable=function(){var changeState=this.changeState(0);if(changeState){this.enabled=0;tetra.weblet.trigger("SE_DISABLED")}};StartEnd.prototype.enable=function(){var changeState=this.changeState(1);if(changeState){this.enabled=1;tetra.weblet.trigger("SE_ENABLED")}};StartEnd.prototype.sendResponse=function(){};StartEnd.prototype.on=function(eventName,options,callBack){var supportedMethod;if(options&&typeof options==="function"){events[eventName]=options;options={}}if(callBack){events[eventName]=callBack}supportedMethod={};supportedMethod.id=CONFIG.START_END[eventName].id;if(options&&options.priority){supportedMethod.priority=options.priority}supportedMethods.push(supportedMethod);return startEnd};events={};supportedMethods=[];startEnd=new StartEnd;return startEnd};tetra.system={run:function(properties){var entryUrl=properties.webApp?"WebApps/"+properties.webApp:properties.path;return tetra.service({service:"local.desktopenv.explorer",namespace:"ingenico.desktopenv"}).reset().connect().call("SelectIcon",{data:{entryUrl:entryUrl}}).disconnect()}};if(typeof module==="object"&&module!=null&&module.exports){module.exports=tetra}else if(typeof define==="function"&&define.amd){define(function(){return tetra})}else{window.tetra=tetra}})(window,document);
